{{define "head"}}
{{end}}

<div class="page-wrapper">
    <div class="grid grid-cols-1 lg:grid-cols-[minmax(0,1fr),320px] gap-8 mt-8 items-start mb-16">

        <!-- ── Main Column ── -->
        <main class="min-w-0 flex flex-col gap-6">

            <!-- Breadcrumb + Title -->
            <div class="bg-card border border-border rounded-md px-5 py-4">
                <a href="/"
                    class="inline-flex items-center gap-1.5 text-muted-foreground text-[13px] font-medium mb-3 hover:text-primary transition-colors">
                    <iconify-icon icon="lucide:arrow-left"></iconify-icon>
                    Back to listings
                </a>
                <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
                    <div>
                        <span class="text-muted-foreground text-[12px] font-semibold block mb-1">
                            {{.Car.Year}} · {{.Car.Make}}
                        </span>
                        <h1 class="text-[28px] font-extrabold m-0 leading-tight text-foreground">{{.Car.Model}}</h1>
                        <span class="text-muted-foreground text-[13px] mt-1.5 flex items-center gap-1">
                            <iconify-icon icon="lucide:map-pin" class="text-primary"></iconify-icon>
                            {{.Car.DealerCity}}, Romania · Added 2 days ago
                        </span>
                    </div>
                    {{if .Car.Badge}}
                    <div class="shrink-0">
                        {{if eq .Car.Badge "New"}}
                        <span
                            class="bg-success text-success-foreground text-[11px] font-bold px-3 py-1 rounded-[3px] uppercase tracking-wider">New</span>
                        {{else if eq .Car.Badge "Hot Deal"}}
                        <span
                            class="bg-accent text-accent-foreground text-[11px] font-bold px-3 py-1 rounded-[3px] uppercase tracking-wider">Hot
                            Deal</span>
                        {{else if eq .Car.Badge "Low Mileage"}}
                        <span
                            class="bg-primary text-primary-foreground text-[11px] font-bold px-3 py-1 rounded-[3px] uppercase tracking-wider">Low
                            km</span>
                        {{end}}
                    </div>
                    {{end}}
                </div>
            </div>

            <!-- Image Gallery -->
            <div class="bg-card border border-border rounded-md overflow-hidden">
                <div class="relative aspect-[16/9] bg-secondary overflow-hidden">
                    <img src="{{.Car.ImageURL}}" alt="{{.Car.Make}} {{.Car.Model}}"
                        class="w-full h-full object-cover transition-opacity duration-300" id="active-image" />
                </div>
                {{if .Car.Gallery}}
                <div class="grid grid-cols-5 gap-2 p-3 border-t border-border bg-secondary/30">
                    <div class="aspect-square rounded-[4px] cursor-pointer overflow-hidden ring-2 ring-primary ring-offset-1 transition-all thumbnail"
                        onclick="updateMainImage(this, '{{.Car.ImageURL}}')">
                        <img src="{{.Car.ImageURL}}"
                            class="w-full h-full object-cover hover:scale-105 transition-transform duration-200" />
                    </div>
                    {{range .Car.Gallery}}
                    <div class="aspect-square rounded-[4px] cursor-pointer overflow-hidden ring-2 ring-transparent ring-offset-1 hover:ring-primary transition-all thumbnail"
                        onclick="updateMainImage(this, '{{.}}')">
                        <img src="{{.}}"
                            class="w-full h-full object-cover hover:scale-105 transition-transform duration-200" />
                    </div>
                    {{end}}
                </div>
                {{end}}
            </div>

            <!-- Spec Grid -->
            <div class="bg-card border border-border rounded-md overflow-hidden">
                <div
                    class="bg-secondary border-b border-border p-3.5 px-4 font-semibold text-[14px] flex items-center gap-2.5 text-foreground">
                    <iconify-icon icon="lucide:info" class="text-primary"></iconify-icon>
                    Vehicle Overview
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 divide-x-0 gap-0">
                    <div class="flex flex-col gap-0.5 p-4 border-b border-r border-border">
                        <span
                            class="text-[11px] text-muted-foreground uppercase tracking-wider font-semibold">Mileage</span>
                        <div class="text-[15px] font-bold text-foreground flex items-center gap-1.5 mt-1">
                            <iconify-icon icon="lucide:gauge" class="text-primary"></iconify-icon>
                            {{.Car.Mileage}} km
                        </div>
                    </div>
                    <div class="flex flex-col gap-0.5 p-4 border-b border-r border-border md:border-r">
                        <span class="text-[11px] text-muted-foreground uppercase tracking-wider font-semibold">Body
                            Type</span>
                        <div class="text-[15px] font-bold text-foreground flex items-center gap-1.5 mt-1">
                            <iconify-icon icon="lucide:car" class="text-primary"></iconify-icon>
                            {{.Car.BodyType}}
                        </div>
                    </div>
                    <div class="flex flex-col gap-0.5 p-4 border-b border-border">
                        <span class="text-[11px] text-muted-foreground uppercase tracking-wider font-semibold">Fuel
                            Type</span>
                        <div class="text-[15px] font-bold text-foreground flex items-center gap-1.5 mt-1">
                            <iconify-icon icon="lucide:fuel" class="text-primary"></iconify-icon>
                            {{.Car.Fuel}}
                        </div>
                    </div>
                    <div class="flex flex-col gap-0.5 p-4 border-b border-r border-border">
                        <span
                            class="text-[11px] text-muted-foreground uppercase tracking-wider font-semibold">Transmission</span>
                        <div class="text-[15px] font-bold text-foreground flex items-center gap-1.5 mt-1">
                            <iconify-icon icon="lucide:settings-2" class="text-primary"></iconify-icon>
                            {{.Car.Transmission}}
                        </div>
                    </div>
                    <div class="flex flex-col gap-0.5 p-4 border-b border-r border-border md:border-r">
                        <span
                            class="text-[11px] text-muted-foreground uppercase tracking-wider font-semibold">Engine</span>
                        <div class="text-[15px] font-bold text-foreground flex items-center gap-1.5 mt-1">
                            <iconify-icon icon="lucide:zap" class="text-primary"></iconify-icon>
                            {{.Car.Engine}}
                        </div>
                    </div>
                    <div class="flex flex-col gap-0.5 p-4 border-b border-border">
                        <span
                            class="text-[11px] text-muted-foreground uppercase tracking-wider font-semibold">Color</span>
                        <div class="text-[15px] font-bold text-foreground flex items-center gap-1.5 mt-1">
                            <iconify-icon icon="lucide:palette" class="text-primary"></iconify-icon>
                            {{.Car.Color}}
                        </div>
                    </div>
                    <div class="flex flex-col gap-0.5 p-4 border-r border-border col-span-2 md:col-span-1">
                        <span class="text-[11px] text-muted-foreground uppercase tracking-wider font-semibold">Drive
                            Type</span>
                        <div class="text-[15px] font-bold text-foreground flex items-center gap-1.5 mt-1">
                            <iconify-icon icon="lucide:route" class="text-primary"></iconify-icon>
                            {{.Car.Drive}}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Description -->
            {{if .Car.Description}}
            <div class="bg-card border border-border rounded-md overflow-hidden">
                <div
                    class="bg-secondary border-b border-border p-3.5 px-4 font-semibold text-[14px] flex items-center gap-2.5 text-foreground">
                    <iconify-icon icon="lucide:text-quote" class="text-primary"></iconify-icon>
                    Description
                </div>
                <div class="p-5 text-[14px] leading-relaxed text-secondary-foreground">
                    <p>{{.Car.Description}}</p>
                </div>
            </div>
            {{end}}

            <!-- Mobile: Price + Contact (visible on small screens only) -->
            <div class="lg:hidden bg-card border border-border rounded-md overflow-hidden">
                <div
                    class="bg-secondary border-b border-border p-3.5 px-4 font-semibold text-[14px] flex items-center gap-2.5 text-foreground">
                    <iconify-icon icon="lucide:tag" class="text-primary"></iconify-icon>
                    Price & Contact
                </div>
                <div class="p-5 flex flex-col gap-3">
                    <div class="text-[28px] font-extrabold text-primary">UGX {{.Car.Price}}</div>
                    <button
                        class="w-full p-3.5 bg-primary text-primary-foreground rounded-md font-bold text-[15px] flex items-center justify-center gap-2 hover:opacity-90 transition-opacity border-none cursor-pointer"
                        onclick="alert('Phone: {{.Car.DealerPhone}}')">
                        <iconify-icon icon="lucide:phone"></iconify-icon>
                        Show Phone Number
                    </button>
                    <button
                        class="w-full p-3.5 bg-secondary border border-border text-foreground rounded-md font-bold text-[15px] flex items-center justify-center gap-2 hover:border-primary hover:text-primary transition-colors cursor-pointer">
                        <iconify-icon icon="lucide:message-square"></iconify-icon>
                        Send Message
                    </button>
                </div>
            </div>
        </main>

        <!-- ── Sticky Sidebar ── -->
        <aside class="hidden lg:flex flex-col gap-6">

            <!-- Sticky Price + Contact Card -->
            <div class="lg:sticky lg:top-6 flex flex-col gap-6">

                <!-- Price Card -->
                <div class="bg-card border border-border rounded-md overflow-hidden">
                    <div class="p-5 border-b border-border">
                        <div class="text-[12px] text-muted-foreground uppercase tracking-wider font-semibold mb-1">
                            Asking Price</div>
                        <div class="text-[30px] font-extrabold text-primary leading-none">UGX {{.Car.Price}}</div>
                        <div class="text-[12px] text-muted-foreground mt-1.5 flex items-center gap-1">
                            <iconify-icon icon="lucide:map-pin"></iconify-icon>
                            {{.Car.DealerCity}}, Romania
                        </div>
                    </div>
                    <div class="p-4 flex flex-col gap-3">
                        <button
                            class="w-full p-3.5 bg-primary text-primary-foreground rounded-md font-bold text-[14px] flex items-center justify-center gap-2 hover:opacity-90 transition-opacity border-none cursor-pointer"
                            onclick="alert('Phone: {{.Car.DealerPhone}}')">
                            <iconify-icon icon="lucide:phone"></iconify-icon>
                            Show Phone Number
                        </button>
                        <button
                            class="w-full p-3.5 bg-secondary border border-border text-foreground rounded-md font-bold text-[14px] flex items-center justify-center gap-2 hover:border-primary hover:text-primary transition-colors cursor-pointer">
                            <iconify-icon icon="lucide:message-square"></iconify-icon>
                            Send Message
                        </button>
                    </div>
                </div>

                <!-- Dealer Card -->
                <div class="bg-card border border-border rounded-md overflow-hidden">
                    <div
                        class="bg-secondary border-b border-border p-3.5 px-4 font-semibold text-[14px] flex items-center gap-2.5 text-foreground">
                        <iconify-icon icon="lucide:user" class="text-primary"></iconify-icon>
                        Listed by Dealer
                    </div>
                    <div class="p-4 flex items-center gap-3">
                        <div
                            class="w-12 h-12 bg-secondary rounded-full flex items-center justify-center text-primary border border-border shrink-0">
                            <iconify-icon icon="lucide:building-2" class="text-[20px]"></iconify-icon>
                        </div>
                        <div>
                            <h4 class="m-0 text-[15px] font-bold text-foreground">{{.Car.DealerName}}</h4>
                            <p class="m-0 mt-0.5 text-[13px] text-muted-foreground">{{.Car.DealerCity}}, Romania</p>
                        </div>
                    </div>
                </div>

                <!-- Safety Tips -->
                <div class="bg-card border border-border rounded-md overflow-hidden">
                    <div
                        class="bg-secondary border-b border-border p-3.5 px-4 font-semibold text-[14px] flex items-center gap-2.5 text-foreground">
                        <iconify-icon icon="lucide:shield-check" class="text-success"></iconify-icon>
                        Safety Tips
                    </div>
                    <ul class="m-0 p-4 pl-5 space-y-2 text-[13px] text-secondary-foreground list-disc">
                        <li>Meet at a safe public location</li>
                        <li>Inspect the vehicle thoroughly</li>
                        <li>Never pay in advance</li>
                        <li>Verify all documents and VIN</li>
                    </ul>
                </div>

                <!-- Similar Cars -->
                {{if .RelatedCars}}
                <div class="bg-card border border-border rounded-md overflow-hidden">
                    <div
                        class="bg-secondary border-b border-border p-3.5 px-4 font-semibold text-[14px] flex items-center gap-2.5 text-foreground">
                        <iconify-icon icon="lucide:car" class="text-primary"></iconify-icon>
                        Similar Cars
                    </div>
                    {{range .RelatedCars}}
                    <a href="/cars/{{.ID}}"
                        class="flex gap-3 p-3 border-b border-border last:border-b-0 no-underline text-inherit hover:bg-secondary/50 transition-colors group">
                        <div class="w-20 h-14 rounded-[4px] overflow-hidden shrink-0 bg-secondary">
                            <img src="{{.ImageURL}}"
                                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-200" />
                        </div>
                        <div class="flex flex-col gap-0.5 overflow-hidden min-w-0">
                            <div class="font-bold text-[13px] leading-tight truncate text-foreground">{{.Make}}
                                {{.Model}}</div>
                            <div class="text-[11px] text-muted-foreground">{{.Year}}</div>
                            <div class="flex items-center gap-2 text-[11px] text-muted-foreground flex-wrap">
                                <span class="flex items-center gap-0.5"><iconify-icon
                                        icon="lucide:settings-2"></iconify-icon> {{.Transmission}}</span>
                                <span class="flex items-center gap-0.5"><iconify-icon icon="lucide:fuel"></iconify-icon>
                                    {{.Fuel}}</span>
                            </div>
                            <div class="text-primary font-bold text-[13px]">UGX {{.Price}}</div>
                        </div>
                    </a>
                    {{end}}
                </div>
                {{end}}

            </div><!-- /sticky wrapper -->
        </aside>
    </div>
</div>

{{define "scripts"}}
<script>
    function updateMainImage(thumb, src) {
        const mainImg = document.getElementById('active-image');
        mainImg.style.opacity = '0';
        setTimeout(() => {
            mainImg.src = src;
            mainImg.style.opacity = '1';
        }, 150);

        document.querySelectorAll('.thumbnail').forEach(t => {
            t.classList.remove('ring-primary');
            t.classList.add('ring-transparent');
        });
        thumb.classList.remove('ring-transparent');
        thumb.classList.add('ring-primary');
    }
</script>
{{end}}